generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url       = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  age       Int
  password  String
  role      String   @default("user")
  avatar    String?
  lastLogin DateTime?

  resetPasswordToken   String? @unique
  resetPasswordExpires DateTime?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relación con vales de gas
  gasVouchers GasVoucher[]
}

model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?  @unique
  age       Int
  password  String
  role      String   @default("admin")
  avatar    String?
  lastLogin DateTime?

  resetPasswordToken   String? @unique
  resetPasswordExpires DateTime?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model GasVoucher {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  kilos         Int      // 15 o 45 kg
  amount        Float?   // Monto en pesos (lo pone el admin al aprobar)
  
  status        String   @default("pending") // pending, approved, rejected, delivered
  
  requestDate   DateTime @default(now())
  approvalDate  DateTime?
  deliveredDate DateTime?
  
  approvedBy    String?  // ID o nombre del admin que aprobó
  notes         String?  // Notas del admin
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
  @@index([status])
}